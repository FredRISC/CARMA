

#include <string.h>
#include <stdlib.h>
#include <stdio.h>

#include <riscv_vector.h>
#include "util.h"



int8_t input_matrix1[256] = {
  62, 68, 83, 71, 39, 20, 89, 87,
  33, 71, 19, 71, 67, 34, 28, 78,
  24, 52, 59, 8, 92, 40, 94, 34,
  62, 99, 78, 26, 8, 98, 10, 6,
  23, 0, 2, 72, 30, 52, 31, 42,
  76, 49, 68, 8, 35, 89, 3, 11,
  39, 54, 94, 19, 21, 86, 55, 3,
  86, 40, 39, 51, 14, 38, 82, 34,
  75, 99, 39, 98, 38, 73, 50, 46,
  6, 55, 76, 37, 61, 10, 63, 23,
  63, 68, 47, 55, 50, 56, 63, 35,
  41, 4, 14, 24, 18, 32, 81, 93,
  80, 60, 64, 23, 20, 7, 16, 61,
  23, 42, 31, 49, 68, 50, 12, 51,
  40, 36, 67, 14, 5, 86, 42, 78,
  69, 37, 93, 74, 51, 10, 48, 14,
  8, 82, 98, 31, 77, 2, 25, 53,
  7, 24, 27, 12, 95, 60, 61, 52,
  14, 77, 55, 71, 30, 95, 72, 45,
  79, 76, 12, 42, 62, 73, 12, 29,
  91, 37, 63, 85, 3, 49, 39, 35,
  33, 58, 73, 43, 92, 52, 8, 64,
  64, 62, 77, 45, 57, 32, 75, 35,
  5, 17, 62, 83, 48, 83, 45, 95,
  62, 75, 98, 12, 78, 12, 71, 41,
  0, 21, 47, 88, 61, 89, 48, 7,
  67, 96, 34, 61, 80, 94, 13, 25,
  64, 55, 50, 35, 2, 63, 71, 93,
  95, 36, 83, 93, 41, 49, 88, 91,
  85, 93, 98, 10, 0, 15, 98, 94,
  19, 14, 70, 74, 12, 3, 29, 9,
  40, 20, 1, 61, 12, 74, 52, 61,
};

int8_t input_matrix2[256] = {
  62, 68, 83, 71, 39, 20, 89, 87,
  33, 71, 19, 71, 67, 34, 28, 78,
  24, 52, 59, 8, 92, 40, 94, 34,
  62, 99, 78, 26, 8, 98, 10, 6,
  23, 0, 2, 72, 30, 52, 31, 42,
  76, 49, 68, 8, 35, 89, 3, 11,
  39, 54, 94, 19, 21, 86, 55, 3,
  86, 40, 39, 51, 14, 38, 82, 34,
  75, 99, 39, 98, 38, 73, 50, 46,
  6, 55, 76, 37, 61, 10, 63, 23,
  63, 68, 47, 55, 50, 56, 63, 35,
  41, 4, 14, 24, 18, 32, 81, 93,
  80, 60, 64, 23, 20, 7, 16, 61,
  23, 42, 31, 49, 68, 50, 12, 51,
  40, 36, 67, 14, 5, 86, 42, 78,
  69, 37, 93, 74, 51, 10, 48, 14,
  8, 82, 98, 31, 77, 2, 25, 53,
  7, 24, 27, 12, 95, 60, 61, 52,
  14, 77, 55, 71, 30, 95, 72, 45,
  79, 76, 12, 42, 62, 73, 12, 29,
  91, 37, 63, 85, 3, 49, 39, 35,
  33, 58, 73, 43, 92, 52, 8, 64,
  64, 62, 77, 45, 57, 32, 75, 35,
  5, 17, 62, 83, 48, 83, 45, 95,
  62, 75, 98, 12, 78, 12, 71, 41,
  0, 21, 47, 88, 61, 89, 48, 7,
  67, 96, 34, 61, 80, 94, 13, 25,
  64, 55, 50, 35, 2, 63, 71, 93,
  95, 36, 83, 93, 41, 49, 88, 91,
  85, 93, 98, 10, 0, 15, 98, 94,
  19, 14, 70, 74, 12, 3, 29, 9,
  40, 20, 1, 61, 12, 74, 52, 61,
};

void vector_add8 (int8_t *src1, int8_t *src2, int8_t *dest)
{
unsigned long cycles1, cycles2;
int64_t total;
cycles1 = read_csr(mcycle);

size_t vl = __riscv_vsetvlmax_e8m8();
vuint8m8_t opd1 = __riscv_vle8_v_u8m8 (src1, vl);
vuint8m8_t opd2 = __riscv_vle8_v_u8m8 (src2, vl);
vuint8m8_t res = __riscv_vadd_vv_u8m8 (opd1, opd2, vl);
__riscv_vse8_v_u8m8 (dest, res, vl);

  cycles2=read_csr(mcycle);
  total = cycles2 - cycles1;
  printf("total cycles for vadd: %d \n",total);
}


int main(void) {

int8_t output[256]={0};
vector_add8(input_matrix1, input_matrix2, output);
for(int i=0;i<16;i++){
   for(int j=0;j<16;j++){
      printf("%d ", output[16*i+j]);
   }
  printf("\n");
}
  return 0;
}
